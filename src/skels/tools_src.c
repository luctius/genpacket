/*
 * File automatically generated by
 * gengen  by Lorenzo Bettini 
 * http://www.gnu.org/software/gengen
 */

#include "tools_src.h"

void
generate_tools_src(FILE *stream, struct tools_src_gen_struct *record, unsigned int indent)
{
  char *indent_str;
  unsigned int i;

  indent_str = (char *) malloc (indent + 1);
  for (i = 0; i < indent; ++i)
    indent_str[i] = ' ';
  indent_str[indent] = '\0';
  indent = 0;

  fprintf (stream, "%s", "#include <stdlib.h>");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "#include <stdint.h>");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "#include <stdbool.h>");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "#include \"");
  fprintf (stream, "%s", (record->prefix ? record->prefix : ""));
  fprintf (stream, "%s", "_tools.h\"");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "static ");
  fprintf (stream, "%s", (record->prefix ? record->prefix : ""));
  fprintf (stream, "%s", "_crc_t crc_reflect(");
  fprintf (stream, "%s", (record->prefix ? record->prefix : ""));
  fprintf (stream, "%s", "_crc_t data, size_t data_len);");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "static void crc_table_gen(const ");
  fprintf (stream, "%s", (record->prefix ? record->prefix : ""));
  fprintf (stream, "%s", "_crc_cfg_t *cfg);");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "static ");
  fprintf (stream, "%s", (record->prefix ? record->prefix : ""));
  fprintf (stream, "%s", "_crc_t crc_init(const ");
  fprintf (stream, "%s", (record->prefix ? record->prefix : ""));
  fprintf (stream, "%s", "_crc_cfg_t *cfg);");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "static ");
  fprintf (stream, "%s", (record->prefix ? record->prefix : ""));
  fprintf (stream, "%s", "_crc_t crc_update(const ");
  fprintf (stream, "%s", (record->prefix ? record->prefix : ""));
  fprintf (stream, "%s", "_crc_cfg_t *cfg, ");
  fprintf (stream, "%s", (record->prefix ? record->prefix : ""));
  fprintf (stream, "%s", "_crc_t crc, const void *data, size_t data_len);");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "static ");
  fprintf (stream, "%s", (record->prefix ? record->prefix : ""));
  fprintf (stream, "%s", "_crc_t crc_finalize(const ");
  fprintf (stream, "%s", (record->prefix ? record->prefix : ""));
  fprintf (stream, "%s", "_crc_cfg_t *cfg, ");
  fprintf (stream, "%s", (record->prefix ? record->prefix : ""));
  fprintf (stream, "%s", "_crc_t crc);");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "/**");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", " * Reflect all bits of a \\a data word of \\a data_len bytes.");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", " *");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", " * \\param data         The data word to be reflected.");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", " * \\param data_len     The width of \\a data expressed in number of bits.");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", " * \\return             The reflected data.");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", " *****************************************************************************/");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "static ");
  fprintf (stream, "%s", (record->prefix ? record->prefix : ""));
  fprintf (stream, "%s", "_crc_t crc_reflect(");
  fprintf (stream, "%s", (record->prefix ? record->prefix : ""));
  fprintf (stream, "%s", "_crc_t data, size_t data_len)");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "{");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "    unsigned int i;");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  indent = 4;
  fprintf (stream, "%s", "    ");
  fprintf (stream, "%s", (record->prefix ? record->prefix : ""));
  fprintf (stream, "%s", "_crc_t ret;");
  indent = 0;
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "    ret = data & 0x01;");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "    for (i = 1; i < data_len; i++) {");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "        data >>= 1;");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "        ret = (ret << 1) | (data & 0x01);");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "    }");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "    return ret;");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "}");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "/**");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", " * Calculate the initial crc value.");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", " *");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", " * \\param cfg  A pointer to a initialised ");
  fprintf (stream, "%s", (record->prefix ? record->prefix : ""));
  fprintf (stream, "%s", "_crc_cfg_t structure.");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", " * \\return     The initial crc value.");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", " *****************************************************************************/");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "static ");
  fprintf (stream, "%s", (record->prefix ? record->prefix : ""));
  fprintf (stream, "%s", "_crc_t crc_init(const ");
  fprintf (stream, "%s", (record->prefix ? record->prefix : ""));
  fprintf (stream, "%s", "_crc_cfg_t *cfg)");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "{");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "    if (cfg->reflect_in) {");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "        return crc_reflect(cfg->xor_in & cfg->crc_mask, cfg->width) << cfg->crc_shift;");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "    } else {");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "        return cfg->xor_in & cfg->crc_mask << cfg->crc_shift;");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "    }");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "}");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "/**");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", " * Populate the private static crc table.");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", " *");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", " * \\param cfg  A pointer to a initialised ");
  fprintf (stream, "%s", (record->prefix ? record->prefix : ""));
  fprintf (stream, "%s", "_crc_cfg_t structure.");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", " * \\return     void");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", " *****************************************************************************/");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "static void crc_table_gen(const ");
  fprintf (stream, "%s", (record->prefix ? record->prefix : ""));
  fprintf (stream, "%s", "_crc_cfg_t *cfg)");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "{");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  indent = 4;
  fprintf (stream, "%s", "    ");
  fprintf (stream, "%s", (record->prefix ? record->prefix : ""));
  fprintf (stream, "%s", "_crc_t crc;");
  indent = 0;
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  indent = 4;
  fprintf (stream, "%s", "    ");
  fprintf (stream, "%s", (record->prefix ? record->prefix : ""));
  fprintf (stream, "%s", "_crc_t *crc_table_ptr = &cfg->crc_table[0];");
  indent = 0;
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "    unsigned int i, j;");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "    for (i = 0; i < 256; i++) {");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "        if (cfg->reflect_in) {");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "            crc = crc_reflect(i, 8);");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "        } else {");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "            crc = i;");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "        }");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "        crc <<= (cfg->width - 8 + cfg->crc_shift);");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "        for (j = 0; j < 8; j++) {");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "            if (crc & (cfg->msb_mask << cfg->crc_shift)) {");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "                crc = (crc << 1) ^ (cfg->poly << cfg->crc_shift);");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "            } else {");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "                crc = crc << 1;");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "            }");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "        }");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "        if (cfg->reflect_in) {");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "            crc = crc_reflect(crc >> cfg->crc_shift, cfg->width) << cfg->crc_shift;");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "        }");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "        crc_table_ptr[i] = crc & (cfg->crc_mask << cfg->crc_shift);");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "    }");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "}");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "/**");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", " * Update the crc value with new data.");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", " *");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", " * \\param crc      The current crc value.");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", " * \\param cfg      A pointer to a initialised ");
  fprintf (stream, "%s", (record->prefix ? record->prefix : ""));
  fprintf (stream, "%s", "_crc_cfg_t structure.");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", " * \\param data     Pointer to a buffer of \\a data_len bytes.");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", " * \\param data_len Number of bytes in the \\a data buffer.");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", " * \\return         The updated crc value.");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", " *****************************************************************************/");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "static ");
  fprintf (stream, "%s", (record->prefix ? record->prefix : ""));
  fprintf (stream, "%s", "_crc_t crc_update(const ");
  fprintf (stream, "%s", (record->prefix ? record->prefix : ""));
  fprintf (stream, "%s", "_crc_cfg_t *cfg, ");
  fprintf (stream, "%s", (record->prefix ? record->prefix : ""));
  fprintf (stream, "%s", "_crc_t crc, const void *data, size_t data_len)");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "{");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "    const unsigned char *d = (const unsigned char *)data;");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "    unsigned int tbl_idx;");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "    if (cfg->reflect_in) {");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "        while (data_len--) {");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "            tbl_idx = ((crc >> cfg->crc_shift) ^ *d) & 0xff;");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "            crc = (cfg->crc_table[tbl_idx] ^ (crc >> 8)) & (cfg->crc_mask << cfg->crc_shift);");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "            d++;");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "        }");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "    } else {");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "        while (data_len--) {");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "            tbl_idx = ((crc >> (cfg->width - 8 + cfg->crc_shift)) ^ *d) & 0xff;");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "            crc = (cfg->crc_table[tbl_idx] ^ (crc << 8)) & (cfg->crc_mask << cfg->crc_shift);");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "            d++;");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "        }");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "    }");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "    return crc & (cfg->crc_mask << cfg->crc_shift);");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "}");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "/**");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", " * Calculate the final crc value.");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", " *");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", " * \\param cfg  A pointer to a initialised ");
  fprintf (stream, "%s", (record->prefix ? record->prefix : ""));
  fprintf (stream, "%s", "_crc_cfg_t structure.");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", " * \\param crc  The current crc value.");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", " * \\return     The final crc value.");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", " *****************************************************************************/");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "static ");
  fprintf (stream, "%s", (record->prefix ? record->prefix : ""));
  fprintf (stream, "%s", "_crc_t crc_finalize(const ");
  fprintf (stream, "%s", (record->prefix ? record->prefix : ""));
  fprintf (stream, "%s", "_crc_cfg_t *cfg, ");
  fprintf (stream, "%s", (record->prefix ? record->prefix : ""));
  fprintf (stream, "%s", "_crc_t crc)");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "{");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "    crc >>= cfg->crc_shift;");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "    if (cfg->reflect_in == !cfg->reflect_out) {");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "        crc = crc_reflect(crc, cfg->width);");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "    }");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "    return (crc ^ cfg->xor_out) & cfg->crc_mask;");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "}");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "uint64_t ");
  fprintf (stream, "%s", (record->prefix ? record->prefix : ""));
  fprintf (stream, "%s", "_crc(");
  fprintf (stream, "%s", (record->prefix ? record->prefix : ""));
  fprintf (stream, "%s", "_crc_cfg_t *cfg,const void *data, size_t len) {");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "    cfg->msb_mask = (crc_t)1u << (cfg->width - 1);");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "    cfg->crc_mask = (cfg->msb_mask - 1) | cfg->msb_mask;");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "    cfg->crc_shift = cfg->width < 8 ? 8 - cfg->width : 0;");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "    cfg->poly &= cfg->crc_mask;");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "    cfg->xor_in &= cfg->crc_mask;");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "    cfg->xor_out &= cfg->crc_mask;");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  indent = 4;
  fprintf (stream, "%s", "    ");
  indent = 0;
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "    //crc8_populate_msb(crc8_table,CRC8_POLY);");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "    //return crc8_calc(crc8_table, data, len, CRC8_INIT_VALUE);");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  indent = 4;
  fprintf (stream, "%s", "    ");
  indent = 0;
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "    if (cfg->table_generated == false) {");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "        crc_table_gen(cfg);");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "        cfg->table_generated = true;");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "    }");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "    /**");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "     * Calculate the initial crc value.");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "     *");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "     * \\param cfg  A pointer to a initialised ");
  fprintf (stream, "%s", (record->prefix ? record->prefix : ""));
  fprintf (stream, "%s", "_crc_cfg_t structure.");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "     * \\return     The initial crc value.");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "     *****************************************************************************/");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  indent = 4;
  fprintf (stream, "%s", "    ");
  fprintf (stream, "%s", (record->prefix ? record->prefix : ""));
  fprintf (stream, "%s", "_crc_t crc =  crc_init(cfg);");
  indent = 0;
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "    /**");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "     * Update the crc value with new data.");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "     *");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "     * \\param crc      The current crc value.");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "     * \\param cfg      A pointer to a initialised ");
  fprintf (stream, "%s", (record->prefix ? record->prefix : ""));
  fprintf (stream, "%s", "_crc_cfg_t structure.");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "     * \\param data     Pointer to a buffer of \\a data_len bytes.");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "     * \\param data_len Number of bytes in the \\a data buffer.");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "     * \\return         The updated crc value.");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "     *****************************************************************************/");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "    crc = crc_update(cfg, crc, data, len);");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "    /**");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "     * Calculate the final crc value.");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "     *");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "     * \\param cfg  A pointer to a initialised ");
  fprintf (stream, "%s", (record->prefix ? record->prefix : ""));
  fprintf (stream, "%s", "_crc_cfg_t structure.");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "     * \\param crc  The current crc value.");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "     * \\return     The final crc value.");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "     *****************************************************************************/");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "    return (uint64_t) crc_finalize(cfg, crc);");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "}");
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);
  fprintf (stream, "%s", "\n");
  fprintf (stream, "%s", indent_str);

  free (indent_str);
}

void
generatep_tools_src(FILE *stream, unsigned int indent, const char *prefix)
{
  struct tools_src_gen_struct record;
  
  record.prefix = prefix;

  generate_tools_src (stream, &record, indent);
}

char *
genstring_tools_src(struct tools_src_gen_struct *record, unsigned int indent)
{
  char *indent_str, *output;
  unsigned int i;
  int len;

  indent_str = (char *) malloc (indent + 1);
  for (i = 0; i < indent; ++i)
    indent_str[i] = ' ';
  indent_str[indent] = '\0';

  len = strcnt_tools_src (record, indent);
  output = (char *) malloc (len + 1);
  output[0] = '\0';

  strcat (output, "#include <stdlib.h>");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "#include <stdint.h>");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "#include <stdbool.h>");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "#include \"");
  if (record->prefix) strcat (output, record->prefix);
  strcat (output, "_tools.h\"");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "static ");
  if (record->prefix) strcat (output, record->prefix);
  strcat (output, "_crc_t crc_reflect(");
  if (record->prefix) strcat (output, record->prefix);
  strcat (output, "_crc_t data, size_t data_len);");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "static void crc_table_gen(const ");
  if (record->prefix) strcat (output, record->prefix);
  strcat (output, "_crc_cfg_t *cfg);");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "static ");
  if (record->prefix) strcat (output, record->prefix);
  strcat (output, "_crc_t crc_init(const ");
  if (record->prefix) strcat (output, record->prefix);
  strcat (output, "_crc_cfg_t *cfg);");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "static ");
  if (record->prefix) strcat (output, record->prefix);
  strcat (output, "_crc_t crc_update(const ");
  if (record->prefix) strcat (output, record->prefix);
  strcat (output, "_crc_cfg_t *cfg, ");
  if (record->prefix) strcat (output, record->prefix);
  strcat (output, "_crc_t crc, const void *data, size_t data_len);");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "static ");
  if (record->prefix) strcat (output, record->prefix);
  strcat (output, "_crc_t crc_finalize(const ");
  if (record->prefix) strcat (output, record->prefix);
  strcat (output, "_crc_cfg_t *cfg, ");
  if (record->prefix) strcat (output, record->prefix);
  strcat (output, "_crc_t crc);");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "/**");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, " * Reflect all bits of a \\a data word of \\a data_len bytes.");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, " *");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, " * \\param data         The data word to be reflected.");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, " * \\param data_len     The width of \\a data expressed in number of bits.");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, " * \\return             The reflected data.");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, " *****************************************************************************/");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "static ");
  if (record->prefix) strcat (output, record->prefix);
  strcat (output, "_crc_t crc_reflect(");
  if (record->prefix) strcat (output, record->prefix);
  strcat (output, "_crc_t data, size_t data_len)");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "{");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "    unsigned int i;");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "    ");
  if (record->prefix) strcat (output, record->prefix);
  strcat (output, "_crc_t ret;");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "    ret = data & 0x01;");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "    for (i = 1; i < data_len; i++) {");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "        data >>= 1;");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "        ret = (ret << 1) | (data & 0x01);");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "    }");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "    return ret;");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "}");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "/**");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, " * Calculate the initial crc value.");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, " *");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, " * \\param cfg  A pointer to a initialised ");
  if (record->prefix) strcat (output, record->prefix);
  strcat (output, "_crc_cfg_t structure.");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, " * \\return     The initial crc value.");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, " *****************************************************************************/");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "static ");
  if (record->prefix) strcat (output, record->prefix);
  strcat (output, "_crc_t crc_init(const ");
  if (record->prefix) strcat (output, record->prefix);
  strcat (output, "_crc_cfg_t *cfg)");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "{");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "    if (cfg->reflect_in) {");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "        return crc_reflect(cfg->xor_in & cfg->crc_mask, cfg->width) << cfg->crc_shift;");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "    } else {");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "        return cfg->xor_in & cfg->crc_mask << cfg->crc_shift;");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "    }");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "}");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "/**");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, " * Populate the private static crc table.");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, " *");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, " * \\param cfg  A pointer to a initialised ");
  if (record->prefix) strcat (output, record->prefix);
  strcat (output, "_crc_cfg_t structure.");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, " * \\return     void");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, " *****************************************************************************/");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "static void crc_table_gen(const ");
  if (record->prefix) strcat (output, record->prefix);
  strcat (output, "_crc_cfg_t *cfg)");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "{");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "    ");
  if (record->prefix) strcat (output, record->prefix);
  strcat (output, "_crc_t crc;");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "    ");
  if (record->prefix) strcat (output, record->prefix);
  strcat (output, "_crc_t *crc_table_ptr = &cfg->crc_table[0];");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "    unsigned int i, j;");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "    for (i = 0; i < 256; i++) {");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "        if (cfg->reflect_in) {");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "            crc = crc_reflect(i, 8);");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "        } else {");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "            crc = i;");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "        }");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "        crc <<= (cfg->width - 8 + cfg->crc_shift);");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "        for (j = 0; j < 8; j++) {");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "            if (crc & (cfg->msb_mask << cfg->crc_shift)) {");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "                crc = (crc << 1) ^ (cfg->poly << cfg->crc_shift);");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "            } else {");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "                crc = crc << 1;");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "            }");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "        }");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "        if (cfg->reflect_in) {");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "            crc = crc_reflect(crc >> cfg->crc_shift, cfg->width) << cfg->crc_shift;");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "        }");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "        crc_table_ptr[i] = crc & (cfg->crc_mask << cfg->crc_shift);");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "    }");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "}");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "/**");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, " * Update the crc value with new data.");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, " *");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, " * \\param crc      The current crc value.");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, " * \\param cfg      A pointer to a initialised ");
  if (record->prefix) strcat (output, record->prefix);
  strcat (output, "_crc_cfg_t structure.");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, " * \\param data     Pointer to a buffer of \\a data_len bytes.");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, " * \\param data_len Number of bytes in the \\a data buffer.");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, " * \\return         The updated crc value.");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, " *****************************************************************************/");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "static ");
  if (record->prefix) strcat (output, record->prefix);
  strcat (output, "_crc_t crc_update(const ");
  if (record->prefix) strcat (output, record->prefix);
  strcat (output, "_crc_cfg_t *cfg, ");
  if (record->prefix) strcat (output, record->prefix);
  strcat (output, "_crc_t crc, const void *data, size_t data_len)");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "{");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "    const unsigned char *d = (const unsigned char *)data;");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "    unsigned int tbl_idx;");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "    if (cfg->reflect_in) {");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "        while (data_len--) {");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "            tbl_idx = ((crc >> cfg->crc_shift) ^ *d) & 0xff;");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "            crc = (cfg->crc_table[tbl_idx] ^ (crc >> 8)) & (cfg->crc_mask << cfg->crc_shift);");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "            d++;");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "        }");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "    } else {");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "        while (data_len--) {");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "            tbl_idx = ((crc >> (cfg->width - 8 + cfg->crc_shift)) ^ *d) & 0xff;");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "            crc = (cfg->crc_table[tbl_idx] ^ (crc << 8)) & (cfg->crc_mask << cfg->crc_shift);");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "            d++;");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "        }");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "    }");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "    return crc & (cfg->crc_mask << cfg->crc_shift);");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "}");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "/**");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, " * Calculate the final crc value.");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, " *");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, " * \\param cfg  A pointer to a initialised ");
  if (record->prefix) strcat (output, record->prefix);
  strcat (output, "_crc_cfg_t structure.");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, " * \\param crc  The current crc value.");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, " * \\return     The final crc value.");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, " *****************************************************************************/");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "static ");
  if (record->prefix) strcat (output, record->prefix);
  strcat (output, "_crc_t crc_finalize(const ");
  if (record->prefix) strcat (output, record->prefix);
  strcat (output, "_crc_cfg_t *cfg, ");
  if (record->prefix) strcat (output, record->prefix);
  strcat (output, "_crc_t crc)");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "{");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "    crc >>= cfg->crc_shift;");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "    if (cfg->reflect_in == !cfg->reflect_out) {");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "        crc = crc_reflect(crc, cfg->width);");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "    }");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "    return (crc ^ cfg->xor_out) & cfg->crc_mask;");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "}");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "uint64_t ");
  if (record->prefix) strcat (output, record->prefix);
  strcat (output, "_crc(");
  if (record->prefix) strcat (output, record->prefix);
  strcat (output, "_crc_cfg_t *cfg,const void *data, size_t len) {");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "    cfg->msb_mask = (crc_t)1u << (cfg->width - 1);");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "    cfg->crc_mask = (cfg->msb_mask - 1) | cfg->msb_mask;");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "    cfg->crc_shift = cfg->width < 8 ? 8 - cfg->width : 0;");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "    cfg->poly &= cfg->crc_mask;");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "    cfg->xor_in &= cfg->crc_mask;");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "    cfg->xor_out &= cfg->crc_mask;");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "    ");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "    //crc8_populate_msb(crc8_table,CRC8_POLY);");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "    //return crc8_calc(crc8_table, data, len, CRC8_INIT_VALUE);");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "    ");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "    if (cfg->table_generated == false) {");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "        crc_table_gen(cfg);");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "        cfg->table_generated = true;");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "    }");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "    /**");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "     * Calculate the initial crc value.");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "     *");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "     * \\param cfg  A pointer to a initialised ");
  if (record->prefix) strcat (output, record->prefix);
  strcat (output, "_crc_cfg_t structure.");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "     * \\return     The initial crc value.");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "     *****************************************************************************/");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "    ");
  if (record->prefix) strcat (output, record->prefix);
  strcat (output, "_crc_t crc =  crc_init(cfg);");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "    /**");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "     * Update the crc value with new data.");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "     *");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "     * \\param crc      The current crc value.");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "     * \\param cfg      A pointer to a initialised ");
  if (record->prefix) strcat (output, record->prefix);
  strcat (output, "_crc_cfg_t structure.");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "     * \\param data     Pointer to a buffer of \\a data_len bytes.");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "     * \\param data_len Number of bytes in the \\a data buffer.");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "     * \\return         The updated crc value.");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "     *****************************************************************************/");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "    crc = crc_update(cfg, crc, data, len);");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "    /**");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "     * Calculate the final crc value.");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "     *");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "     * \\param cfg  A pointer to a initialised ");
  if (record->prefix) strcat (output, record->prefix);
  strcat (output, "_crc_cfg_t structure.");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "     * \\param crc  The current crc value.");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "     * \\return     The final crc value.");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "     *****************************************************************************/");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "    return (uint64_t) crc_finalize(cfg, crc);");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "}");
  strcat (output, "\n");
  strcat (output, indent_str);
  strcat (output, "\n");
  strcat (output, indent_str);

  free (indent_str);

  return output;
}

char *
genstringp_tools_src(unsigned int indent, const char *prefix)
{
  struct tools_src_gen_struct record;
  
  record.prefix = prefix;

  return genstring_tools_src (&record, indent);
}

int
strcnt_tools_src(struct tools_src_gen_struct *record, unsigned int indent)
{
  int length = 0;
  
  length += (record->prefix ? strlen (record->prefix) : 0) * 36;

  return length + 6066;
}

void
init_tools_src_gen_struct(struct tools_src_gen_struct *record)
{
  record->prefix = 0;
}

